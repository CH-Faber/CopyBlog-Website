---
import BaseLayout from "@/layouts/BaseLayout.astro"
import { ArticleList } from "@/components/article-list"
import { Footer } from "@/components/footer"
import SiteHeader from "@/components/site-header.astro"
import { Hero } from "@/components/hero"
import { PAGE_SIZE } from "@/lib/constants"
import { buildSidebarMeta, getSortedPosts, toPostMeta } from "@/lib/posts"
import { getSortedThoughts, toThoughtPreview } from "@/lib/thoughts"

const title = "My Blog | Astro Template"
const description = "A modern, fast, and feature-rich Astro blog template."
const posts = await getSortedPosts()
const allArticles = posts.map((post) => toPostMeta(post))
const sidebarMeta = buildSidebarMeta(allArticles)
const thoughts = await getSortedThoughts()
const thoughtPreviews = thoughts.map((thought) => toThoughtPreview(thought)).slice(0, 4)
---

<BaseLayout {title} {description}>
  <div class="min-h-screen bg-background dark:bg-muted/30">
    <SiteHeader />
    <main>
      <Hero client:idle />
      <section id="home-main" class="scroll-mt-24">
        <ArticleList
          client:visible
          articles={allArticles}
          title="Recent Posts"
          subtitle="All Posts"
          showViewAll={false}
          pagination={{ currentPage: 1, pageSize: PAGE_SIZE, basePath: "/" }}
          sidebarCategories={sidebarMeta.categories}
          sidebarTags={sidebarMeta.tags}
          sidebarThoughts={thoughtPreviews}
        />
      </section>
    </main>
    <Footer />
  </div>
</BaseLayout>
