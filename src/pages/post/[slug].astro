---
import { getCollection, getEntryBySlug } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'
import ArticleContent from '@/components/ArticleContent.astro'
import { Header } from '@/components/header'
import { Footer } from '@/components/footer'

export async function getStaticPaths() {
  const posts = await getCollection('articles')
  return posts.map((post) => ({
    params: { slug: post.slug },
  }))
}

const { slug } = Astro.params
const article = await getEntryBySlug('articles', slug!)

if (!article) {
  return Astro.redirect('/')
}

const { Content } = await article.render()
const description = article.data.excerpt ?? article.body.slice(0, 120)
const title = `${article.data.title} | 思维边界`
---

<BaseLayout {title} {description}>
  <div class="min-h-screen bg-background">
    <Header client:load />
    <ArticleContent article={article} {Content} />
    <Footer />
  </div>
</BaseLayout>
